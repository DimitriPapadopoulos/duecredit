[tox]
envlist = flake8,py3,typing
#,flake8

[testenv]
commands = pytest duecredit
deps = -r{toxinidir}/requirements.txt

[testenv:flake8]
commands = flake8 {posargs}

[testenv:venv]
commands = {posargs}

[testenv:typing]
deps =
    mypy
    types-requests
commands =
    mypy --ignore-missing-imports {posargs} duecredit/

[flake8]
#show-source = True
# E265 = comment blocks like @{ section, which it can't handle
# E266 = too many leading '#' for block comment
# E731 = do not assign a lambda expression, use a def
# W293 = Blank line contains whitespace
#ignore = E265,W293,E266,E731
max-line-length = 120
include = duecredit
exclude = .tox,.venv,venv-debug,build,dist,doc,git/ext/

[pytest]
addopts =
    --cov=duecredit
    # Explicitly setting the path to the coverage config file is necessary due
    # to some tests spawning subprocesses with changed working directories.
    --cov-config=tox.ini
    --tb=short
    --durations=10
filterwarnings =
    # TODO: review/address all warnings
    # error

[coverage:run]
branch = True
parallel = True

[coverage:paths]
source =
    duecredit
    .tox/**/site-packages/duecredit
